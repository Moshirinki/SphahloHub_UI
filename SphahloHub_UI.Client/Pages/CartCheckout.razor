@page "/cart"
@using SphahloHub_UI.Client.Service.Implementation
@using static MudBlazor.Icons.Material
@inject CartService Cart
@inject OrderService Orders
@inject NavigationManager Nav

<MudTable Items="Cart.Items">
    <HeaderContent>
        <MudTh>Sphahlo</MudTh>
        <MudTh>Qty</MudTh>
        <MudTh>Total</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd>@context.Sphahlo.Name</MudTd>
        <MudTd>@context.Quantity</MudTd>
        <MudTd>@context.CalculatePrice().ToString("C")</MudTd>
    </RowTemplate>
</MudTable>

<MudText Typo="Typo.h6">Total: @Cart.GetTotal().ToString("C")</MudText>

<MudButton Color="Color.Success" Variant="Filled" OnClick="Checkout">
    Checkout
</MudButton>

@code {
    private async Task Checkout()
    {
        var res = await Orders.PlaceOrderAsync(Cart, "PayFast");
        if (res != null)
        {
            Cart.Clear();
            Nav.NavigateTo(res.RedirectUrl, forceLoad: true);
        }
    }
}
